{% extends "base.html"%} {%block body%}
<!--CRP: script for the search bar from the left side-->
<style>
    /*Tittle*/
    .repo_tittle{
     font-family: 'Merriweather', serif;   
    }
    .progressBar{
        position: relative;
        margin: 4px;
        float:left;
        text-align: center;
    }
    .barOverflow{ /* Wraps the rotating .bar */
        position: relative;
        overflow: hidden; /* Comment this line to understand the trick */
        width: 90px; height: 45px; /* Half circle (overflow) */
        margin-bottom: -14px; /* bring the numbers up */
    }
    .bar{
        position: absolute;
        top: 0; left: 0;
        width: 90px; height: 90px; /* full circle! */
        border-radius: 50%;
        box-sizing: border-box;
        border: 5px solid #eee;     /* half gray, */
        border-bottom-color: #0bf;  /* half azure */
        border-right-color: #0bf;
    }
    /*progress bar CSS*/
    .progress {
       margin-bottom: 0px;
    }
    * {
      box-sizing: border-box;
    }

    .openBtn {
        background: #000000;
        color: #3498DB;
        border: none;
        padding: 10px 15px;
        font-size: 20px;
        cursor: pointer;    
    }

    .openBtn:hover {
      background: #bbb;
    }

    .overlay {
      height: 100%;
      width: 100%;
      display: none;
      position: fixed;
      z-index: 1;
      top: 0;
      left: 0;
      background-color: rgb(0,0,0);
      background-color: rgba(0,0,0, 0.9);
    }

    .overlay-content {
      position: relative;
      top: 46%;
      width: 80%;
      text-align: center;
      margin-top: 30px;
      margin: auto;
    }

    .overlay .closebtn {
      position: absolute;
      top: 20px;
      right: 45px;
      font-size: 60px;
      cursor: pointer;
      color: white;
    }

    .overlay .closebtn:hover {
      color: #ccc;
    }

    .overlay input[type=text] {
      padding: 15px;
      font-size: 17px;
      border: none;
      float: left;
      width: 80%;
      background: white;
    }

    .overlay input[type=text]:hover {
      background: #f1f1f1;
    }

    .overlay button {
      float: left;
      width: 20%;
      padding: 15px;
      background: #ddd;
      font-size: 17px;
      border: none;
      cursor: pointer;
    }

    .overlay button:hover {
      background: #bbb;
    }

    search_bar_popUp{
        -moz-border-radius: 0px;
        -webkit-border-radius: 0px;
        border-radius: 0px;
    }
    
    body{
        margin: 0;
        padding: 0;
    }
    /*progress bar style*/
    
    /*Style for the repo_menu*/
    ul.repo_menu{
        position:relative;
        top: 50%;
        left: 50%;
        transform: translate(-50%,-50%);
        margin: 0;
        padding: 10px 0;
        background: #bbe4f1;
        display: flex;
        border-radius: 10px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        justify-content:center;
    }
    ul li.repo_menu{
        list-style: none;
        text-align: center;
        display: block;
        border-right: 1px solid rgba(0,0,0,0.2);
        
    }
    ul li.repo_menu:last-child{
        border-right: none;
    }
    ul li a{
        text-decoration: none;
        padding: 0 50px;
        display: block;
    }
     ul li a .icon{
        width: 40px;
        height: 40px;
         text-align: center;   
         overflow: hidden;
         margin: 0 auto 10px;
    }
    ul li a .icon .fab{
        width: 100%;
        height: 100%;
        line-height: 40px;
        font-size: 34px;
        transition: 0.5s;
        color:#000;
    }
    ul li a .icon .fas{
        width: 100%;
        height: 100%;
        line-height: 40px;
        font-size: 34px;
        transition: 0.5s;
        color:#000;
    }
    ul li a .icon .fas:last-child{
        color:#3498DB;
    }
    ul li a .icon .fab:last-child{
        color:#3498DB;
    }
    ul li a:hover .icon .fab{   
        transform: translateY(-100%);
    }
    ul li a:hover .icon .fas{   
        transform: translateY(-100%);
    }
    ul li a .name{
        position: relative;
        height: 20px;
        width: 100%;
        display:block;
        overflow: hidden;
    }
    ul li a .name span{
        position: relative;
        display:block;
        color: #000;
        font-size: 18px;
        line-height: 20px;
        transition: 0.5s;
        
    }
    ul li a .name span:before{
        content: attr(data-text);
        position: absolute;
        top: -100%;
        left: 0;
        width: 100%;
        height: 100%;   
        color:#3498DB;
    }
    ul li a:hover .name span{
        transform: translateY(20px);
    }
    
    div.repo_menu{
        padding-top: 0px;
    }
    
    /*Ontologies CSS table*/
    
    #table_ontology {
        font-family: "Trebuchet MS", Arial, Helvetica, sans-serif;
        border-collapse: collapse;
        width: 100%;
        
    }
    
    #table_ontology td, #customers th {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: center;
    }

    #table_ontology tr:nth-child(even){background-color: #f2f2f2;}

    #table_ontology th {
        padding-top: 12px;
        padding-bottom: 12px;
        text-align: center;
        background-color: #0e4a5d;
        color: white;
    }
    /*Style for the configuration buttons*/
    .config_but{
        display:flex;
    }
    .update_config{
        display: block;
        width: 66.6%;
        border: none;
        background-color: #267fb2;
        padding: 14px 28px;
        font-size: 16px;
        cursor: pointer;
        text-align: center;
        border-bottom-left-radius: 10px;
        font-family: 'Rubik', sans-serif;
        color: #fff;
    }
    
    .stop_watching{
        display: block;
        width: 33.4%;
        border: none;
        background-color: #ff3636;
        padding: 14px 28px;
        font-size: 16px;
        cursor: pointer;
        text-align: center;
        border-bottom-right-radius: 10px;
        font-family: 'Rubik', sans-serif;
        color: #fff;
    }
</style>
<script>
    function openSearch() {
        closeNav();
    document.getElementById("myOverlay").style.display = "block";
    }

    function closeSearch() {
        document.getElementById("myOverlay").style.display = "none";
    }
</script>

<div id="myOverlay" class="overlay">
  <span class="closebtn" onclick="closeSearch()" title="Close Overlay">×</span>
  <div class="overlay-content">
    <form action="/action_page.php">
      <input class="search_bar_popUp" type="text" placeholder="user/repo" name="search">
      <button type="submit"><i class="fa fa-search"></i></button>
    </form>
  </div>
</div>

<div id="mySidebar" class="sidebar">
    <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
    {%for r in repos%}
    <a href="/repository/{{loop.index}}">{{r.url}}</a>
    {%endfor%}
    <a onclick="openSearch()" href="#">add repository</a>
    <!--<a href="#">Services</a>
    <a href="#">Clients</a>
<a href="#">Contact</a>-->
</div>

<div id="main">
  <button class="openbtn" onclick="openNav()">&#9776; My repository list</button>
  <!--h2>Collapsed Sidebar</h2-->
  <!--p>Content...</p-->
</div>

<!--Script for the circular progress bar-->


<!--Tittle of the repository-->
<div style="display: inline-flex;width: 100%;padding-top: 20px">
    <div style="width: 20%;">
        <div class="progressBar">
        <div class="barOverflow">
        <div class="bar"></div>
        </div>
        <span>{{repos[index].progress}}</span>%
        </div>
    </div>
    <div style="width: 60%;">
        <h2 class="repo_tittle">{{repos[index].url}}</h2>
    </div>
    <div style="width: 20%;">
        <h4>Last Used: {{repos[index].last_used}}</h4>
    </div>
</div>

<script>
    $(".progressBar").each(function(){

    var $bar = $(this).find(".bar");
    var $val = $(this).find("span");
    var perc = parseInt( $val.text(), 10);

    $({p:0}).animate({p:perc}, {
    duration: 3000,
    easing: "swing",
    step: function(p) {
      $bar.css({
        transform: "rotate("+ (45+(p*1.8)) +"deg)", // 100%=180° so: ° = % * 1.8
        // 45 is to add the needed rotation to have the green borders at the bottom
      });
      $val.text(p|0);
    }
    });
    }); 
</script>
<!--Progress bar
<div class="progress">
  <div class="progress-bar progress-bar-striped active" role="progressbar"
  aria-valuenow=40 aria-valuemin="0" aria-valuemax="100" style="width:40%">
    40%
  </div>
</div>-->








<!--<META HTTP-EQUIV="refresh" CONTENT="20">-->

<!--<script>-->
    <!--$(document).ready( function(){-->
    <!--//Get the canvas &-->
    <!--context var c = $('#myCanvas');-->
    <!--var ct = c.get(0).getContext('2d');-->
    <!--var container = $(c).parent();-->

    <!--//Run function when browser resizes-->
    <!--$(window).resize( respondCanvas );-->

    <!--function respondCanvas(){-->
        <!--c.attr('width', $(container).width() ); //max width-->
        <!--c.attr('height', $(container).height() ); //max height-->
        <!--//Call a function to redraw other content (texts, images etc)-->
    <!--}-->

    <!--//Initial call-->
    <!--respondCanvas();-->

<!--});-->
<!--</script>-->

<link rel="stylesheet" href="http://rendro.github.io/easy-pie-chart/stylesheets/jquery.easy-pie-chart.css">
<script src="http://rendro.github.io/easy-pie-chart/javascripts/jquery.easy-pie-chart.js"></script>

<script src="https://ahmad88me.github.io/outlinejs/cdn/outline.js"></script>
<!--<script src="media/js/outline.js"></script>-->

<!--<canvas id="myCanvas"  height="200" width="400"  style="border:1px solid #d3d3d3;">
            Your browser does not support the canvas element.
        </canvas>-->
  
 <script>
        var base_area_component = document.getElementById("basearea");
        var canvas = document.getElementById("myCanvas");
        var ctx = canvas.getContext("2d");
        ctx.canvas.width = base_area_component.offsetWidth;
        var g = new OutlineGraph(ctx, {"title_color": "black",
                                 "items_color": "blue",
                                 "inner_color": "#3498DB",
                                 "title_font": "15px Helvetica",
                                 "items_font": "10px Comic Sans MS",
                                 "points": [
                                    {"title": "Pending", "items": []},
                                    {"title": "Diagrams", "items": []},
                                    {"title": "Documentation", "items": []},
                                    {"title": "Evaluating", "items": []},
                                    {"title": "JSON-LD", "items": []},
                                    {"title": "Validation", "items": []},
                                    {"title": "Finished", "items": []},
                                 ]});
        g.draw();
        g.draw_inner(0);

function compute_index(j){
   return 2;
}


var outline_function = function(){

    var graph_data = {
                 "title_color": "black",
                 "items_color": "blue",
                 "inner_color": "#3498DB",
                 "title_font": "15px Helvetica",
                 "items_font": "10px Comic Sans MS",
                 "points": [
                 ]
     }


    $.getJSON('get_outline', function(data){
        //console.log('data: ');
        //console.log(data);
        var stages = Object.keys(data["stages"]);
        var i;
        var points = [];
        //console.log('stages: ');
        //console.log(stages);

        //console.log('stages_length'+stages.length);
        for(i=0;i<stages.length;i++){
            p = {"title": stages[i], "items": data["stages"][stages[i]]}
            points.push(p);
        }
        //console.log('points: .....')
        //console.log(points);
        graph_data["points"] = points


        //console.log('pending: ')
        //console.log(data["stages"]["pending"])
        graph_data["points"] = [
            {"title": "Pending", "items": data["stages"]["pending"]},
            {"title": "Diagrams", "items": data["stages"]["diagram"]},
            {"title": "Documentation", "items": data["stages"]["documentation"]},
            {"title": "Evaluation", "items": data["stages"]["evaluation"]},
            {"title": "JSON-LD", "items": data["stages"]["jsonld"]},
            {"title": "Validation", "items": data["stages"]["validation"]},
            {"title": "Finished", "items": data["stages"]["finished"]}
        ]

        //console.log('points: beau')
        //console.log(graph_data["points"]);


        delete window.g;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        //console.log('graph data')
        //console.log(graph_data);
        g = new OutlineGraph(ctx, graph_data);
        /*
        var g = new OutlineGraph(ctx, {
                                 "points": [
                                    {"title": "Pending", "items": ["ontology1.owl","ontology2.owl" ]},
                                    {"title": "Diagrams", "items": ["ontology3.owl","ontology4.owl" ]},
                                    {"title": "Documentation", "items": []},
                                    {"title": "Evaluating", "items": []},
                                    {"title": "JSON-LD", "items": []},
                                    {"title": "Finished", "items": []},
                                 ]});*/
        g.draw();
        g.draw_inner(data["inner"]);
    });
    //delete window.g
}//outline_function
setInterval(outline_function, 4000);
outline_function();
</script>

<input type="hidden" id="button"/>
<div id="box">
    <!-- Click Me To Return! -->
</div>


<div id="screen"></div>


<link rel="stylesheet" href="//code.jquery.com/ui/1.12.0/themes/base/jquery-ui.css">
<script src="https://code.jquery.com/ui/1.12.0/jquery-ui.js"></script>


<script>


$( function() {
//$( document ).tooltip();
 $( document ).tooltip({ position: { my: "center bottom", at: "center top" }});

});

</script>





<script>

function GetURLParameter(sParam)
{
    var sPageURL = window.location.search.substring(1);
    var sURLVariables = sPageURL.split('&');
    for (var i = 0; i < sURLVariables.length; i++)
    {
        var sParameterName = sURLVariables[i].split('=');
        if (sParameterName[0] == sParam)
        {
            return sParameterName[1];
        }
    }
    return '';
}

</script>

</br></br><br>

<!--
<h5>
	<a class="emph" href="../profilebeta">Try out beta version of "My repositories" page</a>
</h5>
-->

<!--<form action="/" method="GET" style="color: #999">
    <div class="form-group">
        <div class="container-fluid">
            <span class=" col-md-9">
                <input type="text" name="target_repo" id="target_repo_select" class="form-control input-lg"
                       placeholder="user/repo"></br>
            </span>
            <span class="col-md-3">
                <input type="submit" class="form-control color1back color3 input-lg" value="Watch this repo"/>
            </span>
        </div>
    </div>
</form>-->
<div class="repo_menu">
    <ul class="repo_menu">
    <li class="repo_menu">
        <a style="text-decoration:none" href="http://www.github.com/{{repos[index].url}}" target="_blank">
            <div class="icon">
                <i class="fab fa-github"></i>
                <i class="fab fa-github"></i>
            </div>
            <div class="name"><span data-text="Github">Github</span></div>   
        </a>
    </li>
    <li class="repo_menu">
        <a style="text-decoration:none" href="#">
            <div class="icon">
                <i class="fas fa-tools"></i>
                <i class="fas fa-tools"></i>
            </div>
            <div class="name"><span data-text="Configuration">Configuration</span></div>   
        </a>
    </li>
    <li class="repo_menu">
        <a style="text-decoration:none" href="#">
            <div class="icon">
                <i class="fas fa-book"></i>
                <i class="fas fa-book"></i>
            </div>
            <div class="name"><span data-text="Documentation">Documentation</span></div>   
        </a>
    </li>
    <li class="repo_menu">
        <a style="text-decoration:none" href="#">
            <div class="icon">
                <i class="fas fa-sync-alt"></i>
                <i class="fas fa-sync-alt"></i>
            </div>
            <div class="name"><span data-text="Renew">Renew</span></div>   
        </a>
    </li>
    <li class="repo_menu">
        <a style="text-decoration:none" href="#">
            <div class="icon">
                <i class="fas fa-file-import"></i>
                <i class="fas fa-file-import"></i>
            </div>
            <div class="name"><span data-text="Preview">Preview</span></div>   
        </a>
    </li>
</ul>
</div>


<table id="table_ontology">
  <tr>
    <th>Themis</th>
    <th>Ontology</th>
    <th>Diagrams</th>
    <th>Evaluation</th>
    <th>Documentation</th>
    <th>Publish</th>
    <th>Bundle</th>  
  </tr>
  <tr>
    {%for o in ontologies%}
    {% if 'themis_results' in o %}
    <td>{{o.themis_results}} %</td>
    {%else%}
    <td>No</td>
    {%endif%}
      
    {%if o.published%}
    <td style="display: grid"><a href="https://github.com/{{repos[index].url}}/blob/master/{{o.ontology}}" target="_blank">{{o.ontology}}</a>
        <a href="https://w3id.org/def/{{o.pname}}" target="_blank">[{{o.pname}}:https://w3id.org/def/{{o.pname}}]</a></td>
    {%else%}
      <td><a href="https://github.com/{{repos[index].url}}/blob/master/{{o.ontology}}" target="_blank">{{o.ontology}}</a></td>  
    {%endif%}
    {%if o.ar2dtool%}
    <td><input type="checkbox" id="ar2dtool" name="{{o.ontology}}-ar2dtool" checked></td>
    {%else%}
    <td><input type="checkbox" id="ar2dtool" name="{{o.ontology}}-ar2dtool"></td>
    {%endif%}
    {%if o.oops%}
    <td><input type="checkbox" id="oops" name="{{o.ontology}}-oops" checked></td>
    {%else%}
    <td><input type="checkbox" id="oops" name="{{o.ontology}}-oops"></td>
    {%endif%}
    {%if o.widoco%}
    <td><input type="checkbox" id="widoco" name="{{o.ontology}}-widoco" checked></td>
    {%else%}
    <td><input type="checkbox" id="widoco" name="{{o.ontology}}-widoco"></td>
    {%endif%}
    {%if o.published%}
    <td><button class="btn"><i class="fas fa-redo"></i></button></td>
    {%else%}
    <td><button class="btn"><i class="fas fa-upload"></i></button></td>
    {%endif%}
    <td><button class="btn"><i class="fas fa-download"></i></button></td>
  </tr>
    {%endfor%}
</table>
<div class="config_but">
     <button type="button" class="update_config">Update Configuration</button>
     <button type="button" onclick="stopConfirm()"class="stop_watching">Stop Watching</button> 
</div>

<script>
function stopConfirm() {
  confirm("Are you sure you want to unwatch this repo?");
}
</script>
{% if manager%}
<a href="show_repos_list"><div class="btn btn-primary form-control">See live repos list</div></a><br><br>
<a href="show_stats"><div class="btn btn-primary form-control">Show stats</div></a><br><br>
<a href="update_stats"><div class="btn btn-warning form-control">Update stats (Takes a couple of minutes to update)</div></a><br><br>
{%endif%}

<p class="red">{{error}}</p>



<!--<h4>You can see what is going on with your repositories <a href="/progress">here</a></h4>-->
<span id="profiletables">
	<h3>Choose one of the below repo by clicking on it</h3>
	<div class="panel-group " id="accordion">
        <div class="container-fluid">
            {%for r in repos%}
            {%if r.notes != ''%}
                <div class="panel panel-info">
                <!--<div class="panel  panel-danger ">-->
            {%else%}
                <!--<div class="panel color5back">-->
                <div class="panel panel-info">
            {%endif%}
                    <div class="panel-heading firsttime" >
                        <h4 class="panel-title">
                            <a data-toggle="collapse" class="accordion-toggle" data-parent="#accordion"
                               href="#coll{{loop.index}}">
                                <div class="row">
                                    <div class="col-md-7 col-sm-7 " style="text-align: left">
                                        <i class="col-md-1 col-sm-1 indicator glyphicon glyphicon-chevron-right"></i>
                                        <span class="col-md-11 col-sm-11 " >
                                            <!--<span class="col-md-12 col-sm-12 darktext" style="word-break: break-all">{{r.url}}</span>-->
                                            <!--<span class="col-md-6 col-sm-6 darktext" style="word-break: break-all">{{r.url}}</span>-->
                                            <!--<p class="col-md-6 col-sm-6" style="word-break: break-all">{{r.state}}</p>-->
                                            <span class="col-md-4 col-sm-4 darktext" style="word-break: break-all">{{r.url}}</span>
                                            <p class="col-md-3 col-sm-3" style="word-break: break-all">{{r.state}}</p>
                                            <p class="col-md-3 col-sm-3" style="word-break: break-all">{{r.notes}}</p>
                                            <div class="col-md-2 col-sm-2" style="word-break: break-all">
                                                <div class="progress">
                                                  {%if r.progress == 100 %}
                                                <div class="progress-bar progress-bar-info" role="progressbar"
                                                     aria-valuenow='{{"%.2f"|format(r.progress|float) }}'
                                                     aria-valuemin="0"
                                                     aria-valuemax="100"
                                                     style="width: {{r.progress}}%">
                                                  {{"%.2f"|format(r.progress|float) }}%
                                                </div>
                                                  {%else%}
                                                  <div class="progress-bar progress-bar-info progress-bar-striped active"
                                                       role="progressbar"
                                                       aria-valuenow='{{"%.2f"|format(r.progress|float) }}' aria-valuemin="0"
                                                       aria-valuemax="100"
                                                       style="width: {{r.progress}}%">
                                                  {{"%.2f"|format(r.progress|float) }}%
                                                </div>

                                                  {%endif%}
                                              </div>
                                            </div>

                                        </span>
                                    </div>


                                    <div class="col-md-3 col-sm-3 ">

                                        <div class="col-md-2 col-sm-2">
                                            <a href="http://www.github.com/{{r.url}}" target="_blank"
                                               title="Go to repo in GitHub">
                                            <img src="https://raw.githubusercontent.com/OnToology/OnToology/master/media/icons/GitHub-Mark-32px.png"
                                                 class="img-circle" height="25px"></a>
                                        </div>
                                        <div class="col-md-2 col-sm-2 handpointer" style="color: #000;" >
                                            <span class="glyphicon glyphicon-refresh  repo" url="{{r.url}}" title="Get ontologies configuration in this repo"></span>
                                        </div>
                                        <div class="col-md-2 col-sm-2 ">
                                            <span class="generateall-btn handpointer" repo="{{r.url}}" title="Generate documentation, diagrams and evaluation">
                                                <img src="https://raw.githubusercontent.com/OnToology/OnToology/master/media/icons/regenerate_all.png" height="20px">
                                            </span>
                                        </div>
                                        {%if r.previsual_page_available %}
                                            <div class="col-md-2 col-sm-2 "> <a href="/renew_previsual?target_repo={{r.url}}" title="Renew previsualization">
                                                <img src="https://raw.githubusercontent.com/OnToology/OnToology/master/media/icons/renew_previsual.png" height="20px"> </a>
                                            </div>
                                        {%else%}
                                            <div class="col-md-2 col-sm-2 "> <a href="/renew_previsual?target_repo={{r.url}}" title="Generate previsualization">
                                                <img src="https://raw.githubusercontent.com/OnToology/OnToology/master/media/icons/renew_previsual.png" height="20px"> </a>
                                            </div>
                                        {%endif%}
                                        <div class="col-md-2 col-sm-2 ">
                                        {%if r.previsual_page_available %}
                                            <a href="http://{{r.user}}.github.io/{{r.rrepo}}" title="Go to previsualization"><img src="https://raw.githubusercontent.com/OnToology/OnToology/master/media/icons/go_to_previsual.png"
                                                                            height="20px"></a>
                                        {%endif%}
                                            </div>

                                    </div>


                                    <div class="col-md-2 col-sm-2 darktext  " align="right">
                                        {{r.last_used }}
                                    </div>
                                    </br>
                                </div>
                                <!-- end of row-->
                            </a>
                        </h4>
                    </div>
                    <div id="coll{{loop.index}}" class="panel-collapse collapse ">
                        <div class="panel-body ">

                            <div class="ontologiesspace"> </div>
                            </br>
                        </div>
                    </div>
                </div>
                {%endfor%}
            </div>
        </div>
    </div>


</span>




</br>

<style>
    .bootstrap-switch .bootstrap-switch-handle-on.bootstrap-switch-primary,.bootstrap-switch
    .bootstrap-switch-handle-off.bootstrap-switch-primary
    {
    color: #fff !important;
    background: #333333 !important;
    }
</style>


</span>


<!--<span id="slidertag"> </span>-->


<script>


var current_url;
var m;
$( document ).ready(function() {





	//taken from http://hungred.com/how-to/tutorial-simple-screen-grey-effect-jquery/
	var greyout = function(){
		$('#screen').css({	"display": "block", opacity: 0.7, "width":$(document).width(),"height":$(document).height()});
	}


	var cc = false;
	$(".nonrepo").click(function(){
		//alert();
		cc = true;
	});
	$(document).on('click', '.closee', function(){
	//$(".closee").click(function() {
		//alert("close");
		//cc = true;
		if (confirm("Are you sure you want to unwatch this repo?")==false){
			return
		}
		greyout();
		console.log("this attr url: "+$(this).attr('url'));
		$.ajax({
			  method: "GET",
			  url: "/delete_repo?repo="+$(this).attr('url'),
			}).done(function(resp){
				//alert("The status: "+resp.status)
				if(resp.status==false){
					alert("error deleting the repo");
					console.log(resp.error);
				}
				else{
					location.reload(true);
				}
				remove_greyout();
			});
	});

	function remove_greyout(){
		$('#box').click();
	}

	$(".repo").click(function() {
		if (cc){
			cc=false;
			return;
		}
		var targetpanel = $(this);
		//var bodypanel = $(this).parent().find(".ontologiesspace");
		//var bodypanel = $(this).parent().parent().parent().parent().parent().parent().find(".ontologiesspace");
		//var bodypanel = $(this).parent().parent().parent().parent().parent().find(".ontologiesspace");
        var bodypanel = $(this).parent().parent().parent().parent().parent().parent().find(".ontologiesspace");
		current_url = $(this).attr('url');
		//greyout();
		$.ajax({
		  method: "GET",
		  url: $(location).attr('protocol')+"//"+$(location).attr('host')+"/profile?repo="+targetpanel.attr('url'),
		  beforeSend: function(){view_progress(); $('#loading').attr('style', "width: 10%")} ,
			xhr: function(){
				/*source: http://stackoverflow.com/questions/15668339/can-onprogress-functionality-be-added-to-jquery-ajax-by-using-xhrfields*/
				// get the native XmlHttpRequest object
				//alert($(location).attr('protocol')+"//"+$(location).attr('host')+"/profile?repo="+targetpanel.attr('url'));
				var xhr = $.ajaxSettings.xhr() ;
				// set the onprogress event handler
				xhr.onprogress = function(evt){ console.log(Math.round(evt.loaded/evt.total * 100)); $('#loading').attr('style', "width: "+Math.round(evt.loaded/evt.total * 100)+"%") } ;
				// set the onload event handler
				xhr.onload = function(){ console.log('DONE!') } ;
				// return the customized object
				return xhr ;
			}
		}).done(function( resp ) {
		    hide_progress()
		    console.log('resp: ')
		    console.log(resp)
		    console.log('ontologies: ')
		    console.log(resp.ontologies)
		    ontologies = resp.ontologies;
		    if (ontologies.length==0){
		    	alert("Make sure you merge the pull request. If there is no pull request, made a change to the ontology and push it to your repository");
			}
		    var o;
		    var temp;
		    var republish_img;
            var ar2dtool_checked='';
            var widoco_checked='';
            var oops_checked='';
            var republish_control_class;
            if(ontologies.length>0){
		    	//bodypanel.html('<div class="col-md-3 col-xs-3" >Ontology</div><div class="col-md-2 col-xs-2" >Diagrams</div><div class="col-md-2 col-xs-2" >Evaluation</div><div class="col-md-2 col-xs-2" >Documentation</div><div class="col-md-2 col-xs-2" >Publish</div><div class="col-md-1 col-xs-1">Bundle</div></br><hr>');
		        bodypanel.html('<div class="col-md-10 col-xs-10">'+
		                '<div class="col-md-6 col-xs-6">Ontology</div>' +
		                '<div class="col-md-2 col-xs-2" >Diagrams</div>'+
		                '<div class="col-md-2 col-xs-2" >Evaluation</div>'+
		                '<div class="col-md-2 col-xs-2" >Documentation</div>'+
		                '</div>'+
		                '<div class="col-md-1 col-xs-1" >Publish</div>'+
		                '<div class="col-md-1 col-xs-1">Bundle</div></br><hr>');
		    }
		    temp=bodypanel.html();
		    temp += '<form action="/update_conf" method="POST">'
		    //bodypanel.html(temp + '<form action="/update_conf" method="POST">');
		    for(o=0;o<ontologies.length;o++){
		    	//temp=bodypanel.html();
		    	//alert(ontologies[o].published);
		    	if(ontologies[o].published==true){
		    		republish_img = 'https://raw.githubusercontent.com/OnToology/OnToology/master/media/icons/republish.png';
		    		republish_control_class = 'republish-class';
		    		republish_title = "Republish this ontology"
		    		w3id_text = "<a style='color: #C0C0C0 !important;' target='_blank' href='"+
		    		    "https://w3id.org/def/"+ontologies[o].pname +"'>" +
		    		"[ " + ontologies[o].pname + " :  " + "https://w3id.org/def/"+ontologies[o].pname +
		    		" ]  "+ "</a>" +
		    		 '<a href="/profile?delete-name='+ontologies[o].pname+'"><span class="glyphicon glyphicon-remove"></span></a>'
		    	}
		    	else{
		    	    republish_img = 'https://raw.githubusercontent.com/OnToology/OnToology/master/media/icons/publish.png';
		    	    republish_control_class = 'publish-class';
		    	    republish_title = "Publish this ontology"
		    	    w3id_text = ""
		    	}
		    	if(ontologies[o].ar2dtool==true){
		    	    ar2dtool_checked = 'checked';
		    	}
		    	else{
		    	    ar2dtool_checked = '';
		    	}
		    	if(ontologies[o].widoco==true){
		    	    widoco_checked = 'checked';
		    	}
		    	else{
		    	    widoco_checked = '';
		    	}
		    	if(ontologies[o].oops==true){
		    	    oops_checked = 'checked';
		    	}
		    	else{
		    	    oops_checked = '';
		    	}


		    	if(ontologies[o].hasOwnProperty('themis_results')){
		    	    ontologies[o]['themis_div'] = '<div class="chart" data-percent="'+
		    	        ontologies[o]["themis_results"]+
		    	        '"><span><font size="1">'+
		    	        ontologies[o]["themis_results"]+
		    	        '%</font></span></div>';
		    	}
		    	else{
		    	    ontologies[o]['themis_div'] = '';//'<div class="chart" data-percent="0">0%</div>'
		    	}

				temp += "<input type='hidden' name='ontology' value='"+ontologies[o].ontology+"'/>"
		    	//temp += '<div class="row">'
		    	temp = temp +
		    	        '<div class="col-md-10 col-xs-10">'+
                                '<div class="col-md-6 col-xs-6">'+
                                    "<a href='https://github.com/"+current_url+"/blob/master"+ontologies[o].ontology+"'>"+
                                    ontologies[o].ontology.substr(1)+"</a>"+ ontologies[o].themis_div +
                                '</div>'+
                                '<div class="col-md-2 col-xs-2 ">'+
                                    '<input type="checkbox" class=" " name="'+ontologies[o].ontology+'-ar2dtool" '+ar2dtool_checked+'>'+
                                '</div>'+
                                '<div class="col-md-2 col-xs-2">'+
                                        '<input type="checkbox" class=" col-md-2 col-xs-2" name="'+ontologies[o].ontology+'-oops" '+oops_checked+'>'+
                                '</div>'+
                                '<div class="col-md-2 col-xs-2">'+
                                        '<input type="checkbox" class=" col-md-2 col-xs-2" name="'+ontologies[o].ontology+'-widoco" '+widoco_checked+'>'+
                                '</div>'+
                                '<div class="col-md-12 col-xs-12 ">'+
                                    '<div class="col-md-6 col-xs-6" style="color: #C0C0C0 !important;">'+
                                        w3id_text +
                                    '</div>'+
                                '</div>'+
                        '</div>'+

		    			'<div class="col-md-1 col-xs-1">'+
		    			    '<span class="btn btn-default '+republish_control_class+'" '+
		    			    'pname="'+ontologies[o].pname+'" repo="'+current_url+'" '+
		    			    'ontology="'+ontologies[o].ontology+'"'+
		    			    ' title="'+republish_title+'">'+
		    				'<img src="'+republish_img+'" height="20px" ontology="'+ontologies[o].ontology+
		    					'" pname="'+ontologies[o].pname+
		    					'" repo="'+current_url+'" > </span></div>'+
		    				'<div class="col-md-1 col-xs-1"><span title="Download documentation, diagrams, evaluation and .htaccess" class="bundle-btn btn btn-default" repo="'+current_url+'" ontology="'+ontologies[o].ontology+'"><img src="https://raw.githubusercontent.com/OnToology/OnToology/master/media/icons/bundle_download.png" height="20px"/></span></div>'+
		    			"<br><br>"
		    			//);
		    }//end for
		    //temp= bodypanel.html();
		    if(ontologies.length>0){
            	temp += '<input type="hidden" name="repo" value="'+current_url+'"/>';
            	temp += '<input type="hidden" name="csrfmiddlewaretoken" value="'+'{{csrf_token}}'+'"/>';



                //temp += '<div class="col-md-9 col-xs-9">'

		    	temp += '<input type="submit" class="btn color7back color0 col-md-10 col-xs-10" value="Update Configuration">';

                //temp += '</div>'

                temp += '<div class="col-md-2 col-xs-2 ">'

		    	temp += '<a class="closee btn color0 red1back col-md-12 col-xs-12" url="'+current_url+'" >Stop Watching</a>';

		    	temp += '</div>'


		    	console.log(current_url)







		    }
		    else{
			    temp = '<a class="closee btn btn-danger color3 col-md-12 col-xs-12 " url="'+current_url+'" >Stop Watching</a>';
			    console.log(current_url)
		    }
		    console.log('now appending to the panel: '+temp)
		    bodypanel.html(temp + '</form>');
		    //$("#slidertag").html(resp.sliderhtml);
		    //initsliders();
		    $('#box').click();

            refresh_easy_pie_chart();


		});
	});//repo selector


	$(".savebtn").click(function(){

			result['repo'] = current_url;
			result['csrfmiddlewaretoken'] = '{{csrf_token}}';
			 $.ajax({
				  method: "POST",
				  beforeSend: function (request)
		           {
		                request.setRequestHeader("X-CSRFToken", '{{csrf_token}}');
		            },
				  url: "/update_conf",
				  data: result
				}).always(function( resp ) {
					console.debug("status is: "+resp.status)
				    if (resp.status == true){
				    	alert('Configuration changed successfully');
				    }
				    else{
				    	alert("Error updating the configuration of one of the ontologies, please try again");
				    	console.log("resp error"+resp.error);
				    	//alert(resp.error);
				    }
				});
	});



});

/*
 var v;
 $.ajax({
		  method: "GET",
		  url: "http://127.0.0.1:8000/profile?repo=ahmad88me/target",
		}).done(function( resp ) {
		    v = resp;
		});

		    */


</script>

<br>

<div id="progressbox" style="opacity:0.8;
    position:fixed;
    width:100%;
    height:100%;
    top:0px;
    left:0px;
    z-index:1000;
 background-color: #333333;">
    <div style="    width: 90%;
    height: 100px;
    //background-color: red;
    position: absolute;
    top:0;
    bottom: 0;
    left: 0;
    right: 0;
    margin: auto;">
        <div class="progress progress-striped active">
            <div id="loading" class="progress-bar progress-bar-custom progress-bar-info" role="progressbar" aria-valuenow="60"
                 aria-valuemin="0" aria-valuemax="100" style="width: 60%;">
            </div>
        </div>
    </div>
</div>


<script>
	$("#progressbox").hide();
	$('#get-ontologies-btn').click(function(){
		var selected_repo = $('#repo-select').val();
		//alert(selected_repo);
		$.ajax({
		  method: "GET",
		  url: window.location.href+"?repo="+selected_repo,
		  beforeSend: function(){view_progress(); $('#loading').attr('style', "width: 10%")} ,
			xhr: function(){
				/*source: http://stackoverflow.com/questions/15668339/can-onprogress-functionality-be-added-to-jquery-ajax-by-using-xhrfields*/

				// get the native XmlHttpRequest object
				var xhr = $.ajaxSettings.xhr() ;
				// set the onprogress event handler
				xhr.onprogress = function(evt){ console.log(Math.round(evt.loaded/evt.total * 100)); $('#loading').attr('style', "width: "+Math.round(evt.loaded/evt.total * 100)+"%") } ;
				// set the onload event handler
				xhr.onload = function(){ console.log('DONE!') } ;
				// return the customized object
				return xhr ;
			}
		}).done(function( resp ) {
		    ontologies = resp.ontologies;
		    if (ontologies.length==0){
		    	alert("Make sure you merge the pull request. If there is no pull request, made a change to the ontology and push it to your repository");
			}
			else{
				var i;
				var options_html="";
				for(i=0;i<ontologies.length;i++){
					options_html += "<option>"+ontologies[i].ontology+"</option>"
				}
				$('#ontology-select').html(options_html);
			}
			hide_progress()
		  });

	});


	function hide_progress(){
		$('#loading').attr('style', "width: "+"80"+"%")
		$('#loading').attr('style', "width: "+"90"+"%")
		$('#loading').attr('style', "width: "+"100"+"%")
		setTimeout(hide_progress_actual, 1000);
	}

	function hide_progress_actual(){
		$("#progressbox").hide();
	}

	function view_progress(){
		//$("#progressbox").css('z-index: 3;');
		$("#progressbox").show();
	}

    $(document).on('click', '.publish-class', function(){
        //alert($(this).attr('repo'));
        $("#publish-add-repo-input").val($(this).attr('repo'));
        $("#publish-add-ontology-input").val($(this).attr('ontology'));
        $("#publish-modal-add").modal();
    });

	$(document).on('click', '.republish-class', function(){
        //alert($(this).attr('repo'));
        $("#publish-add-repo-input").val($(this).attr('repo'));
        $("#publish-add-ontology-input").val($(this).attr('ontology'));
        $("#newname").val($(this).attr('pname'));
        $("#publish-name-form").submit();
        //$("#publish-modal-add").modal();
    });

    $(document).on('click', '.bundle-btn', function(){
    	window.location.href = "/get_bundle?repo="+$(this).attr('repo')+"&ontology="+$(this).attr('ontology');
    	//$.get("get_bundle", {"repo": $(this).attr('repo'), "ontology": $(this).attr('ontology') });
        //$.post("get_bundle", {"repo": $(this).attr('repo'), "ontology": $(this).attr('ontology'), csrfmiddlewaretoken: document.getElementsByName('csrfmiddlewaretoken')[0].value });
    });

    $(document).on('click', '.generateall-btn', function(){
        alert($(this).attr('repo'));
        $.get("generateforall", {"repo": $(this).attr('repo')});
    });






function toggleChevron(e) {
    //console.log('toggle')
    //alert('toggle');
    $(e.target)
        .prev('.panel-heading')
        .find("i.indicator")
        .toggleClass('glyphicon-chevron-down glyphicon-chevron-right');
}


$(document).on('click', ".firsttime", function(){
		//alert("This is the first time");
		$(this).removeClass("firsttime");
		$(this).find(".repo").click();
		$(this).find(".glyphicon-chevron-right").click();
	});

//$('#accordion').on('hidden.bs.collapse', toggleChevron);
//$('#accordion').on('shown.bs.collapse', toggleChevron);
$('#accordion').on('hide.bs.collapse', toggleChevron);
$('#accordion').on('show.bs.collapse', toggleChevron);


</script>

<script>
	toastr.options["positionClass"] = "toast-top-full-width";
	function show_error(error){
		toastr.error(error);
	}
</script>


<script type="text/javascript">
function refresh_easy_pie_chart(){
        $('.chart').easyPieChart({
        size: 35,
        barColor: "#2950ab", // blue
        //barColor: "#15cc0e", // green
        //your configuration goes here
    });
    }
</script>



<div class="modal fade " id="publish-modal-add" tabindex="-1" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content ">
            <div class="modal-header btn-primary">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
                <!--<h4 class="modal-title">Reserve a name</h4>-->
                <!--<h4 align="left">Reserve a name</h4>-->
                <!--<p align="left " alt="left">Reserve a name</p>-->
                Reserve a name
            </div>
            <div class="modal-body highl">
                <br>

                <form id="publish-name-form" action="publish" method="GET" style="color: #999">
                    <div class="form-group">
                        <div class="container-fluid">
	                <span class=" col-md-9 col-xs-9">
                        <input type="hidden" id="publish-add-repo-input" name="repo"/>
                        <input type="hidden" id="publish-add-ontology-input" name="ontology"/>
                		<input type="text" name="name" class="form-control" id="newname"
                               placeholder="Enter the name you would like to reserve">
                        <br>
	                </span>
                    <span class="col-md-3 col-xs-3">
                        <input type="submit" class="form-control btn color1back color3" style="background-color: #333333;color: #FBFBFB;"
                               value="Reserve"/>
                    </span>
                        </div>
                    </div>
                </form>


            </div>
            <!--<div class="modal-footer">-->
            <!--<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>-->
            <!--<button type="button" class="btn btn-primary">Save changes</button>-->
            <!--</div>-->
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div><!-- /.modal -->

<br><br><br><br>
<br><br><br><br>


{% endblock %}
